{% extends 'sistema/base.html' %}
{% block title %}Atividades do Módulo{% endblock %}
{% block content %}
<h1 class="h4">Atividades</h1>
<p class="text-muted mb-3">{{ modulo.id_turma.nome }} — {{ modulo.id_disciplina.nome }}</p>
<div class="mb-3">
  <a class="btn btn-sm btn-success" href="{% url 'professor_criar_atividade' modulo.id %}"><i class="bi bi-plus-circle"></i> Nova Atividade</a>
  <a class="btn btn-sm btn-outline-secondary" href="{% url 'professor_minhas_turmas' %}">Voltar</a>
</div>
{% if atividades %}
  <div class="accordion" id="atividadesAccordion">
    {% for a in atividades %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ a.id }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ a.id }}">
            {{ a.data }} — {{ a.descricao|truncatechars:80 }}
          </button>
        </h2>
        <div id="collapse{{ a.id }}" class="accordion-collapse collapse" data-bs-parent="#atividadesAccordion">
          <div class="accordion-body">
            <p><strong>Data:</strong> {{ a.data }}</p>
            <p><strong>Descrição:</strong><br>{{ a.descricao|linebreaks }}</p>
            <hr>
            <h6>Entregas</h6>
            {% if a.entregas.all %}
              <div class="list-group">
              {% for e in a.entregas.all %}
                <div class="list-group-item">
                  <div class="d-flex justify-content-between">
                    <div>
                      <strong>{{ e.id_aluno.usuario.get_full_name|default:e.id_aluno.usuario.username }}</strong>
                      <div class="text-muted small">Entregue em {{ e.data_entrega|date:'d/m/Y H:i' }}</div>
                      <div class="small">Nota: {% if e.nota %}{{ e.nota }}{% else %}<span class="text-warning">Pendente</span>{% endif %}</div>
                      {% if e.arquivo %}
                        <div class="small mt-1">
                          <i class="bi bi-paperclip"></i> <a href="{{ e.arquivo.url }}" target="_blank">Baixar arquivo</a>
                        </div>
                      {% endif %}
                      {% if e.resposta_texto %}
                        <div class="small mt-1"><strong>Resposta:</strong> {{ e.resposta_texto|truncatechars:120 }}</div>
                      {% endif %}
                    </div>
                    <div class="text-end">
                      <a class="btn btn-sm btn-primary" href="{% url 'professor_corrigir_entrega' e.id %}">
                        <i class="bi bi-pencil-square"></i> Corrigir
                      </a>
                    </div>
                  </div>
                </div>
              {% endfor %}
              </div>
            {% else %}
              <div class="text-muted">Nenhuma entrega ainda.</div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">Nenhuma atividade cadastrada ainda.</div>
{% endif %}
{% endblock %}