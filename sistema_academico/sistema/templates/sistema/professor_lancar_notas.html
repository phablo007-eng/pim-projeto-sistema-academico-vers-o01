{% extends 'sistema/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2>Lançar notas - {{ modulo.id_turma.nome }} / {{ modulo.id_disciplina.nome }}</h2>
  <p>Professor: {{ modulo.id_professor.usuario.get_full_name|default:modulo.id_professor.usuario.username }}</p>

  <form method="post">
    {% csrf_token %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Aluno</th>
            <th>Prova 1</th>
            <th>Prova 2</th>
            <th>Média</th>
            <th>Status</th>
            <th>Risco</th>
          </tr>
        </thead>
        <tbody>
          {% for reg in registros %}
          <tr>
            <td>{{ reg.id_aluno.usuario.get_full_name|default:reg.id_aluno.usuario.username }}</td>
            <td style="max-width:120px;">
              <input type="number" step="0.01" min="0" max="10"
                     class="form-control" name="nota1_{{ reg.id_aluno_id }}"
                     value="{% if reg.nota_prova1 %}{{ reg.nota_prova1 }}{% endif %}">
            </td>
            <td style="max-width:120px;">
              <input type="number" step="0.01" min="0" max="10"
                     class="form-control" name="nota2_{{ reg.id_aluno_id }}"
                     value="{% if reg.nota_prova2 %}{{ reg.nota_prova2 }}{% endif %}">
            </td>
            <td>{% if reg.media_final is not None %}{{ reg.media_final|floatformat:2 }}{% else %}-{% endif %}</td>
            <td>{{ reg.status|title }}</td>
            <td>
              {% if reg.risco == 'alto' %}
                <span class="badge bg-danger">Alto</span>
              {% elif reg.risco == 'moderado' %}
                <span class="badge bg-warning text-dark">Moderado</span>
              {% elif reg.risco == 'ok' %}
                <span class="badge bg-success">OK</span>
              {% else %}
                <span class="badge bg-secondary">Pendente</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5">Nenhum aluno encontrado nesta turma.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <button class="btn btn-primary" type="submit">Salvar notas</button>
    <a class="btn btn-secondary" href="{% url 'professor_minhas_turmas' %}">Voltar</a>
  </form>
</div>
{% endblock %}
